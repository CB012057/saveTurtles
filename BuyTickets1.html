<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TICKETS</title>
    <link rel="stylesheet" href="TicketsPageStyles.css">
    
</head>
<body>
    <img src="D:\360_F_565733952_Q43U5mBQZvC2DDWVUJjGcTSFKCMxPKV2.jpg" alt="TurtleLogo" class="logo">
    <ul>
        <li><a href="index.html"><b>Home</b></a></li>
        <li><a href="Categories.HTML"><b>Categories</b></a></li>
        <li><a href="Hikkaduwa Turtle Hatchery.html"><b>Hikkaduwa Turtle Hatchery</b></a></li>
        <li><a href="Threats.html"><b>Threats</b></a></li>
        
        <li><a href="Donations.html"><b>Donations</b></a></li>
     
    </ul>
    </div>
    </div>
    <br>
    <br>
    <br>
    <div class="headerTickets">
        <h1><center>BUY TICKETS</center></h1>
        </div>
        <img src="D:\image\turtle-in-the-sand-wallpaper.jpg" class="img1">
        
        <br>
        <br>
        
      
        <p class="PK">Welcome to the Hikkaduwa turtle Hatchery. Book your tickets now to have an amazing experience with us.</p>
        
    <h1><center>SELECT FROM BELOW</center></h1>
    <div class="container"><center>
        <div class="block">
            <form id="BookTickets" action="" method="post">
                <div class="form-block"> 
                    <table>     
                    <tr>
                        <td>
                            <label for="SL-Adult">Sri Lankan Adult</label>
                            <p>Above 15 yrs</p>
                        </td>
                        <td>
                            <input type="number" name="SL-Adult" id="SL-Adult" value="0" min="0">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="SL-Child">Sri Lankan Child</label>
                            <p>5 to 14 yrs</p>
                        </td>
                        <td>
                            <input type="number" name="SL-Child" id="SL-Child" value="0" min="0">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="SL-Infant">Sri Lankan Infant</label>
                            <p>Under 4 yrs</p>
                        </td>
                        <td>
                            <input type="number" name="SL-Infant" id="SL-Infant" value="0" min="0">
                        </td>
                    </tr><tr>
                        <td>
                            <label for="Foreign-Adult">Foreign Adult</label>
                            <p>Above 15 yrs</p>
                        </td>
                        <td>
                            <input type="number" name="Foreign-Adult" id="Foreign-Adult" value="0" min="0">
                        </td>
                    </tr><tr>
                        <td>
                            <label for="Foreign-Child">Foreign Child</label>
                            <p>5 to 14 yrs</p>
                        </td>
                        <td>
                            <input type="number" name="Foreign-Child" id="Foreign-Child" value="0" min="0">
                        </td>
                    </tr><tr>
                        <td>
                            <label for="Foreign-Infant">Foreign Infant</label>
                            <p>Under 4 yrs</p>
                        </td>
                        <td>
                            <input type="number" name="Foreign-Infant" id="Foreign-Infant" value="0" min="0">
                        </td>
                    </tr>
                    </table>
                </div>
                <br>
                <br>
                <br>
                <div class="form-block">
                    <input type="date" name="Visit-Date" id="Visit-Date">
                </div>
                <br>
                <br>
                <br>
                <div class="form-block" id="sess-block">
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess001" value="7-8" data-time="7">
                        <label for="Sess001">07.00 AM - 08.00 AM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess002" value="8-9" data-time="8">
                        <label for="Sess002">08.00 AM - 09.00 AM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess003" value="9-10" data-time="9">
                        <label for="Sess003">09.00 AM - 10.00 AM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess004" value="10-11" data-time="10">
                        <label for="Sess004">10.00 AM - 11.00 AM <span>(Peak)</span></label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess005" value="11-12" data-time="11">
                        <label for="Sess005">11.00 AM - 12.00 PM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess006" value="12-13" data-time="12">
                        <label for="Sess006">12.00 PM - 1.00 PM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess007" value="13-14" data-time="13">
                        <label for="Sess007">1.00 PM - 2.00 PM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess008" value="14-15" data-time="14">
                        <label for="Sess008">2.00 PM - 3.00 PM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess009" value="15-16" data-time="15">
                        <label for="Sess009">3.00 PM - 4.00 PM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess010" value="16-17" data-time="16">
                        <label for="Sess010">4.00 PM - 5.00 PM</label>
                    </div>
                    <div class="sub-form-block">
                        <input type="checkbox" name="session" id="Sess011" value="17-18" data-time="17">
                        <label for="Sess011">5.00 PM - 6.00 PM <span>(Peak)</span></label>
                    </div>
                </div>
            </form>
        </div>
        <br>
        <br>
        <br>
        <div class="block">
            <div id="displayer"></div>
            <br><br>
            <a href="DetailsPage.html" class="button-get" onclick="setStorage()">Click to purchase</a>
           
            </div>
            </center>
        </div>
        <br>
        <br>
        <footer>
            <div class="row primary">
                <div class="column about">
                    <h3>Help Us Save The Turtles</h3>
                    <p>
                        Turtles plays a vital role in maintaining the health of the World's oceans for more than 100 million years.So it's our responsibility to protect these animals which are a gift from nature.
                    </p>
                </div>
                <div class="column links">
                    <h3>Quick SneakPeak</h3>
                    <div class="ul90">
                    <ul>
                        <li>
                            <a href="DonationsTurtles.html">Donate Now</a>
                        </li>
                        <li>
                            <a href="Merch.html">Purchase Merch</a>
                        </li>
                        <li>
                            <a href="Categories.HTML">Learn More</a>
                        </li>
                    </ul>
                    </div>
                </div>
            </div>
    </footer>

        <script>
            const getDate = document.getElementById("Visit-Date");
            getDate.addEventListener('input', function() {
                visitDate = getDate.value; 
            });            
            var timeDuration;
            function TicketDetails(frame){
                const coverFrame = document.querySelector(frame);

                // // collect all data
                const IdList = ["SL-Adult","SL-Child","SL-Infant","Foreign-Adult","Foreign-Child","Foreign-Infant"];
                const costPer = {
                    'Local Adult':{ normal: 4, peak: 6, count : 0 },
                    'Local Child':{ normal: 2, peak: 3, count : 0 },
                    'Foreign Adult':{ normal: 10, peak: 13, count : 0 },
                    'Foreign Child':{ normal: 5, peak: 8, count : 0 },
                    'Infant':{ normal: 0, peak: 0, count : 0 },
                };
                
                let totalCost = 0;

                //const getDate = document.getElementById("Visit-Date").value;
                
                // getDate.addEventListener('input', function() {
                //     visitDate = getDate.value; 
                //     updateDetails();
                // });

                // Session Times
                const timeSess = document.getElementById("sess-block");
                const checkTimSess = timeSess.querySelectorAll('input[type="checkbox"]');
                timeDuration = "" , spendTime = "" ,visitDate = "";;
                let peakSess = 0 ,defSess = 0 ;
                checkTimSess.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const choosenSess = [];
                        choosenSess.length = 0;
                        peakSess = 0, defSess = 0;

                        checkTimSess.forEach(cb => {
                        if(cb.checked){
                            choosenSess.push(parseInt(cb.getAttribute('data-time')));
                        }
                    });

                    checkTimSess.forEach(cb => {
                        const sessTime = parseInt(cb.getAttribute('data-time'));
                        if  (choosenSess.length > 1 && 
                            sessTime > Math.min(...choosenSess) && 
                            sessTime < Math.max(...choosenSess)){
                                cb.checked = true;
                        }
                    });

                    checkTimSess.forEach(cb => {
                        if(cb.checked){
                            if (cb.getAttribute('data-time') === '10' || cb.getAttribute('data-time') === '17') {
                                peakSess++;
                            }  
                        }
                    });

                        const countSelects = timeSess.querySelectorAll('input[type="checkbox"]:checked').length;
                        defSess = countSelects - peakSess;
                        timeDuration = countSelects + 'hrs ( ' + defSess + ' Normal : ' + peakSess + ' Peak )';
                        let startTime = choosenSess[0], endTime = (startTime + countSelects);

                        // Adjust for 12-hour clock format
                        if (startTime >= 12) {
                            if (startTime === 12) {
                                startTime = 12 + "PM";
                            }else{
                                startTime = (startTime % 12) + " PM";
                            }
                        }else{
                            startTime = startTime + " AM";
                        }
                        if (endTime >= 12) {
                            if (endTime === 12) {
                                endTime = 12 + "PM";
                            }else{
                                endTime = (endTime % 12) + " PM";
                            }
                        }else{
                            endTime = endTime + " AM";
                        }

                        spendTime = startTime + " to " + endTime;

                        console.log(timeDuration);
                        localStorage.setItem("timeDuration", timeDuration);
                        console.log(spendTime);
                        updateDetails();

                    });
                });

                // Attach event listeners to input elements
                for (let j = 0; j < IdList.length; j++) {
                    const inputElement = document.getElementById(IdList[j]);

                    inputElement.addEventListener('input', function() {
                        updateDetails();
                    });
                }
                
                function Structure(){
                    const ticketDetails = document.createElement("div");

                    let topTable = `
                        <table>
                            <tr>
                                <td>Date</td>
                                <td>${visitDate}</td>
                            </tr>
                            <tr>
                                <td>Time</td>
                                <td>${spendTime}</td>
                            </tr>
                            <tr>
                                <td>Duration</td>
                                <td>${timeDuration}</td>
                            </tr>
                        </table>
                    `;
                    ticketDetails.innerHTML += topTable;

                    let bottomTable = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Tickets</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    totalCost = 0;

                    for (const ticketType in costPer) {
                        if (costPer.hasOwnProperty(ticketType)) {
                            const cost = (costPer[ticketType].normal * defSess * costPer[ticketType].count) + (costPer[ticketType].peak * peakSess * costPer[ticketType].count);

                            console.log(ticketType + ' Normal Cost: ' + (costPer[ticketType].normal * defSess * costPer[ticketType].count));
                            console.log(ticketType + ' Peak Cost: ' + (costPer[ticketType].peak * peakSess * costPer[ticketType].count));

                            totalCost += cost;

                            bottomTable += `
                                <tr>
                                    <td>${ticketType}</td>
                                    <td>${cost}</td>
                                </tr>
                            `;
                        }
                    }

                    // After the loop, you can add the total cost to the bottomTable as well
                    bottomTable += `
                        <tr>
                            <td>Total</td>
                            <td>${totalCost}</td>
                        </tr>
                    `;

                    ticketDetails.innerHTML += bottomTable;

                    return ticketDetails;
                }

                function updateDetails(){
                    Structure();




                    // Update input values
                    slAdultCount = parseInt(document.getElementById("SL-Adult").value);
                    slChildCount = parseInt(document.getElementById("SL-Child").value);
                    slInfantCount = parseInt(document.getElementById("SL-Infant").value);
                    foreignAdultCount = parseInt(document.getElementById("Foreign-Adult").value);
                    foreignChildCount = parseInt(document.getElementById("Foreign-Child").value);
                    foreignInfantCount = parseInt(document.getElementById("Foreign-Infant").value);

                    // Update ticket counts in the costPer object
                    costPer['Local Adult'].count = slAdultCount;
                    costPer['Local Child'].count = slChildCount;
                    costPer['Foreign Adult'].count = foreignAdultCount;
                    costPer['Foreign Child'].count = foreignChildCount;
                    costPer['Infant'].count = slInfantCount + foreignInfantCount;
                    
                    // Update the HTML structure with the new values
                    const ticketStructure = Structure();
                    coverFrame.innerHTML = ""; // Clear previous content
                    coverFrame.appendChild(ticketStructure);

                    
                }
            
                updateDetails();

            }
            visitDate = document.getElementById("Visit-Date").value;
            function setStorage(){
                

                localStorage.setItem("slAdultCount", slAdultCount);
                localStorage.setItem("slChildCount", slChildCount);
                localStorage.setItem("slInfantCount", slInfantCount);
                localStorage.setItem("foreignAdultCount", foreignAdultCount);
                localStorage.setItem("foreignChildCount", foreignChildCount);
                localStorage.setItem("foreignInfantCount", foreignInfantCount);

                localStorage.setItem("totalCost", totalCost);
                localStorage.setItem("visitDate", visitDate );
                localStorage.setItem("spendTime", spendTime);
                localStorage.setItem("peakSess", peakSess);
                localStorage.setItem("defSess", defSess);

                
            }

            TicketDetails("#displayer");
        </script>
</body>
</html>